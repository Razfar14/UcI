<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Untuk Yang Berulang Tahun</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="world-container">
        
        <section class="gift-section">
            <h1 style="margin-bottom: 20px; z-index: 6;">Tap Kado-nya! üéÅ</h1>
            
            <div class="gift-container" id="gift" onclick="openGift()">
                <div class="gift-glow"></div>
                <div class="gift-lid">
                    <div class="bow"></div>
                </div>
                <div class="gift-box"></div>
            </div>

            <div class="card-area" id="cardArea"></div>
        </section>

        <section class="cake-section">
            
            <p class="wish-text" id="wishText" style="font-size: 1.5em; top: 20%; padding: 0 20px; box-sizing: border-box;">...</p>
            
            <audio id="musicCards" loop>
                <source src="musikAwal.mp3" type="audio/mpeg">
            </audio>

            <audio id="musicCake" loop>
                <source src="musikKue.mp3" type="audio/mpeg">
            </audio>
            <div class="cake-container" id="cakeContainer">
                <div class="cake">
                    <div class="plate"></div>
                    <div class="layer layer-bottom"></div>
                    <div class="layer layer-middle"></div>
                    <div class="layer layer-top"></div>
                    <div class="icing"></div>
                    <div class="drip drip1"></div>
                    <div class="drip drip2"></div>
                    <div class="drip drip3"></div>
                    <div class="candle">
                        <div class="flame"></div>
                        <div class="smoke"></div>
                    </div>
                </div>
            </div>

            <button id="blowButton" style="display: none;">Tahan untuk Meniup</button>
            
            <h1 class="final-message" id="finalMsg">üéâHappy Birthday!üéâ</h1>
        </section>

    </div>

    <script>
        // ================= CONFIG AUDIO (SFX) =================
        // Ganti nama file sesuai file kamu
        const sfxBlow = new Audio('tiup.mp3');   // Suara angin meniup
        const sfxParty = new Audio('party.mp3'); // Suara terompet/tepuk tangan

        sfxBlow.loop = true; // Agar suara tiup tidak putus saat ditahan lama
       
        // ================= HELPER: FUNGSI FADE OUT =================
        // Fungsi ini akan menurunkan volume perlahan sampai 0
        function fadeOutAudio(audioEl, duration) {
            const stepTime = 50; // Update setiap 50ms
            const steps = duration / stepTime; // Berapa kali update
            const volStep = audioEl.volume / steps; // Berapa banyak volume turun per update

            const fadeInterval = setInterval(() => {
                // Cek apakah volume masih cukup besar untuk dikurangi
                if (audioEl.volume > volStep) {
                    audioEl.volume -= volStep;
                } else {
                    // Jika sudah sangat kecil, matikan total
                    audioEl.volume = 0;
                    audioEl.pause();
                    audioEl.currentTime = 0; // Reset lagu
                    clearInterval(fadeInterval); // Hentikan loop
                }
            }, stepTime);
        }

        // Ambil referensi 2 musik background
        const musicCards = document.getElementById('musicCards');
        const musicCake = document.getElementById('musicCake');
        // ================= DATA KARTU =================
        const cardsData = [
            { type: "Ucapan Untuk", img: "foto1.jpg", text: "Selamat Ulang Tahun! Semoga Ulang Tahun mu menjadi yang terbaik." },
            { type: "Terima Kasih ", img: "kucing.jpg", text: "Terimakasi untuk semuanya Iler! Mungkin kamu pasti tau kenapa hehe...." },
            { type: "Doa Untuk Mu", img: "emot.webp", text: "Dari ku, ku doakan semoga yang yang kau impikan menjadi kenyataan." },
            { type: "Sesuatu Hal Yang Mengigatkan Mu", img: "FotoPengingat.png", text: "Semoga semua janji akan menjadi nyata" }
        ];

        const gift = document.getElementById('gift');
        const cardArea = document.getElementById('cardArea');
        const worldContainer = document.getElementById('world-container');
        const blowButton = document.getElementById('blowButton');
        const wishText = document.getElementById('wishText');
        const finalMsg = document.getElementById('finalMsg');
        const cakeContainer = document.getElementById('cakeContainer'); // Referensi Kue
        
        
        let isGiftOpened = false;
        let cardElements = []; 

        function initCards() {
            cardsData.forEach((data, index) => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.style.zIndex = cardsData.length - index; 
                const imgHTML = data.img ? `<img src="${data.img}" alt="Foto">` : '';
                card.innerHTML = `<h3>${data.type}</h3>${imgHTML}<p>${data.text}</p><div class="tap-hint">Tap untuk lanjut &rarr;</div>`;
                card.onclick = () => handleCardClick(index);
                cardArea.appendChild(card);
                cardElements.push(card);
            });
        }
        initCards();

        function openGift() {
            if (isGiftOpened) return;
            isGiftOpened = true;
            // --- FASE 1: Play Musik Awal (Kartu) ---
            musicCards.volume = 0.5; 
            musicCards.play().catch(e => console.log("Gagal play musik kartu:", e));
            gift.classList.add('shaking');
            setTimeout(() => {
                gift.classList.remove('shaking');
                gift.classList.add('open');
                setTimeout(() => { revealCards(); }, 600);
            }, 1000);
        }

        function revealCards() {
            cardElements.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('active');
                    const randomRotate = (Math.random() * 10) - 5; 
                    card.style.transform = `translateY(0) rotate(${randomRotate}deg)`;
                }, index * 100);
            });
        }

        function handleCardClick(index) {
            const currentCard = cardElements[index];
            currentCard.classList.add('swiped');
            if (index === cardsData.length - 1) {
                setTimeout(() => { finishCards(); }, 800);
            }
        }

        // --- LOGIKA UTAMA: JATUH -> PESAN -> KUE MUNCUL ---
        function finishCards() {
            worldContainer.classList.add('falling-effect');

            // --- FADE OUT MUSIK KARTU ---
            // Musik akan mengecil perlahan selama 1.5 detik (1500ms)
            fadeOutAudio(musicCards, 1500);
            
            setTimeout(() => {
                worldContainer.classList.remove('falling-effect');
                worldContainer.classList.add('landed-impact');
                
                // 1. Munculkan Pesan "Ada yang kurang" (KUE MASIH HILANG)
                setTimeout(() => {
                    wishText.innerText = "Sepertinya kayaknya ada yang kurang dari ulang tahun ini";
                    wishText.classList.add('show');

                    // 2. Baca pesan selama 3 detik
                    setTimeout(() => {
                        wishText.classList.remove('show'); // Pesan hilang

                        // 3. MAGIC MOMENT: Kue Muncul + Pesan Baru
                        setTimeout(() => {
                            // Munculkan Kue
                            cakeContainer.classList.add('show-cake');
                            
                            // --- FASE 2: Play Musik Kue (Happy Birthday) ---
                            musicCake.volume = 0.6; 
                            musicCake.play().catch(e => console.log("Gagal play musik kue:", e));
                            
                            // Ganti teks
                            wishText.innerText = "Make a Wish... ‚ú®";
                            wishText.classList.add('show');
                            
                            // Munculkan tombol
                            setTimeout(() => {
                                initBlowFeature();
                            }, 1000); 
                            
                        }, 1000); // Jeda setelah teks hilang

                    }, 3000); // Durasi baca teks pertama
                }, 500);
            }, 1000); 
        }

        function initBlowFeature() {
            blowButton.style.display = 'block';
            blowButton.style.opacity = 0;
            blowButton.style.transition = 'opacity 1s';
            setTimeout(() => blowButton.style.opacity = 1, 100);

            let blowTimer;
            const flames = document.querySelectorAll('.flame');
            const smokes = document.querySelectorAll('.smoke');

            function startBlowing(e) {
                e.preventDefault();
                blowButton.style.transform = 'translateX(-50%) scale(0.95)';
                // --- 2. NYALAKAN SFX TIUP ---
                sfxBlow.currentTime = 0; // Reset ke awal
                sfxBlow.play();
                flames.forEach(f => { f.style.transform = "scale(1.2)"; f.style.animationDuration = '0.3s'; });

                blowTimer = setTimeout(() => {
                    flames.forEach(f => f.classList.add('out'));
                    smokes.forEach(s => s.classList.add('rise'));
                    // Matikan suara tiup
                    sfxBlow.pause();

                    // --- STOP MUSIK KUE SAAT SURPRISE ---
                    //musicCake.pause();
                    
                    // --- 3. NYALAKAN SFX SURPRISE ---
                    //sfxParty.play();
                    blowButton.style.display = 'none';
                    wishText.style.opacity = 0;
                    finalMsg.style.opacity = 1;
                }, 2000);
            }

            function stopBlowing() {
                clearTimeout(blowTimer);
                blowButton.style.transform = 'translateX(-50%) scale(1)';
                // Matikan suara tiup jika tombol dilepas sebelum selesai
                sfxBlow.pause();
                sfxBlow.currentTime = 0;
                flames.forEach(f => {
                    if (!f.classList.contains('out')) {
                       f.style.transform = "scale(1)"; f.style.animationDuration = '3s'; 
                    }
                });
            }

            blowButton.addEventListener('mousedown', startBlowing);
            blowButton.addEventListener('mouseup', stopBlowing);
            blowButton.addEventListener('mouseleave', stopBlowing);
            blowButton.addEventListener('touchstart', startBlowing);
            blowButton.addEventListener('touchend', stopBlowing);
        }
    </script>
</body>
</html>